
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Default Behavior &#8212; QC Lab  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=744294ec" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/defaults';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Algorithm Development" href="algorithm_dev.html" />
    <link rel="prev" title="Model Development" href="model_dev.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo-light.png" class="logo__image only-light" alt="QC Lab  documentation - Home"/>
    <img src="../_static/logo-dark.png" class="logo__image only-dark pst-js-only" alt="QC Lab  documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../software_reference/index.html">
    Software Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/tempelaar-team/qc_lab" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../software_reference/index.html">
    Software Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/tempelaar-team/qc_lab" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quickstart/quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="drivers/drivers.html">Dynamics Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="models/models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithms/algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_object.html">Data Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_dev.html">Model Development</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Default Behavior</a></li>
<li class="toctree-l1"><a class="reference internal" href="algorithm_dev.html">Algorithm Development</a></li>
</ul>
</div>
</nav></div>
        <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Default Behavior</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="default-behavior">
<span id="defaults"></span><h1>Default Behavior<a class="headerlink" href="#default-behavior" title="Link to this heading">#</a></h1>
<section id="default-simulation-settings">
<h2>Default Simulation Settings<a class="headerlink" href="#default-simulation-settings" title="Link to this heading">#</a></h2>
<p>By default QC Lab uses the following settings in the simulation object. These settings can be adjusted by changing the values in the <cite>sim</cite> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">()</span>
<span class="n">sim</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">var</span> <span class="o">=</span> <span class="n">val</span> <span class="c1"># Can change the value of a setting like this</span>

<span class="c1"># or by passing the setting directly to the simulation object.</span>
<span class="n">sim</span> <span class="o">=</span> <span class="n">Simulation</span><span class="p">({</span><span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">val</span><span class="p">})</span>
</pre></div>
</div>
<div class="pst-scrollable-table-container"><table class="table" id="id1">
<caption><span class="caption-text">Default Simulation Settings</span><a class="headerlink" href="#id1" title="Link to this table">#</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>num_trajs</cite></p></td>
<td><p>The total number of trajectories to run.</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p><cite>batch_size</cite></p></td>
<td><p>The (maximum) number of trajectories to run simultaneously.</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p><cite>tmax</cite></p></td>
<td><p>The total time of each trajectory.</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p><cite>dt</cite></p></td>
<td><p>The timestep used for executing the update recipe (the dynamics propagation).</p></td>
<td><p>0.01</p></td>
</tr>
<tr class="row-even"><td><p><cite>dt_output</cite></p></td>
<td><p>The timestep used for executing the output recipe (the calculation of observables).</p></td>
<td><p>0.1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>QC Lab expects that the total time of the simulation is an integer multiple of the output timestep <cite>dt_output</cite>, which must also be an integer multiple
of the propagation timestep <cite>dt</cite>.</p>
</div>
</section>
<section id="default-model-attributes">
<h2>Default Model Attributes<a class="headerlink" href="#default-model-attributes" title="Link to this heading">#</a></h2>
<p>For minimal models where only the Hamiltonian of the system is defined in the Model class, QC Lab employs numerical methods to carry out
particular steps in the dynamics algorithms. This page describes those default actions and also the constants that can be used to manipulate them.
Because they are formally treated as model ingredients they  have the same ingredient format discussed in the model development guide.</p>
<p>All of the constants below can be set by adjusting their value in the <cite>model.constants</cite> object, for example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="c1"># fix the value of the constant &#39;default_value&#39;</span>
</pre></div>
</div>
<section id="initialization-of-classical-coordinates">
<h3>Initialization of classical coordinates<a class="headerlink" href="#initialization-of-classical-coordinates" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="sim.model.init_classical">
<span class="sig-prename descclassname"><span class="pre">sim.model.</span></span><span class="sig-name descname"><span class="pre">init_classical</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constants</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">seed</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sim.model.init_classical" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>seed</strong> (<em>np.ndarray</em><em>(</em><em>(</em><em>batch_size</em><em>)</em><em>, </em><em>dtype=int</em><em>)</em>) – List of seeds used to initialize random numbers.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Initial complex-valued classical coordinate.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray((batch_size, sim.model.constants.num_classical_coordinates), dtype=complex)</p>
</dd>
</dl>
</dd></dl>

<p>By default, QC Lab uses a Markov-chain Monte Carlo implementation of the Metropolis-Hastings algorithm to sample a Boltzmann distribution corresponding to
<cite>sim.model.h_c</cite> at the thermal quantum <cite>sim.model.constants.kBT</cite>. We encourage caution and further validation before using it on arbitrary classical
potentials as fine-tuning of the algorithm parameters may be required to obtain reliable results.</p>
<p>The implementation utilizes a single random walker in <cite>sim.model.constants.num_classical_coordinates</cite> dimensions or <cite>sim.model.constants.num_classical_coordinates</cite>
walkers each in one dimension (depending on if <cite>mcmc_h_c_separable==True</cite>) and evolves the walkers from the initial point <cite>mcmc_init_z</cite> by sampling a Gaussian distribution with
a standard deviation <cite>mcmc_std</cite> for <cite>mcmc_burn_in_size</cite> steps. It then evolves the walkers another <cite>mcmc_sample_size</cite> steps to collect a distribution of initial coordinates from which
the required number of initial conditions are drawn uniformly. At a minimum, one should ensure that <cite>mcmc_sample_size</cite> is large enough to ensure a full exploration of the phase-space.</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 23.1%" />
<col style="width: 61.5%" />
<col style="width: 15.4%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Variable name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>mcmc_burn_in_size</cite></p></td>
<td><p>Number of burn-in steps.</p></td>
<td><p>10000</p></td>
</tr>
<tr class="row-odd"><td><p><cite>mcmc_sample_size</cite></p></td>
<td><p>Number of samples to collect from which initial conditions are drawn. To ensure a full exploration of the phase-space this should be as large as practical.</p></td>
<td><p>100000</p></td>
</tr>
<tr class="row-even"><td><p><cite>mcmc_h_c_separable</cite></p></td>
<td><p>A boolean indicating if the classical Hamiltonian is separable into independent terms for each coordinate. If True each coordinate will be independently sampled improving the performance of the algorithm. If False the sampling will occur in the full dimensional space.</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-odd"><td><p><cite>mcmc_init_z</cite></p></td>
<td><p>The initial coordinate that the random walker is initialized at.</p></td>
<td><p>A point in the interval (0,1) for both real and imaginary parts in each coordinate. (This is deterministically chosen for reproducability).</p></td>
</tr>
<tr class="row-even"><td><p><cite>mcmc_std</cite></p></td>
<td><p>The standard deviation of the Gaussian used to generate the random walk.</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="classical-hamiltonian-gradients">
<h3>Classical Hamiltonian gradients<a class="headerlink" href="#classical-hamiltonian-gradients" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="sim.model.dh_c_dzc">
<span class="sig-prename descclassname"><span class="pre">sim.model.</span></span><span class="sig-name descname"><span class="pre">dh_c_dzc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constants</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sim.model.dh_c_dzc" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>z</strong> (<em>np.ndarray</em><em>(</em><em>(</em><em>batch_size</em><em>, </em><em>sim.model.constants.num_classical_coordinates</em><em>)</em><em>, </em><em>dtype=complex</em><em>)</em>) – complex-valued classical coordinate.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gradient of the classical Hamiltonian.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray((batch_size, sim.model.constants.num_classical_coordinates), dtype=complex)</p>
</dd>
</dl>
</dd></dl>

<p>QC Lab utilizes a finite difference method to calculate the gradient of the classical Hamiltonian.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>dh_qc_dzc_finite_differences_delta</cite></p></td>
<td><p>Finite difference that each coordinate is varied by.</p></td>
<td><p>1e-6</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="quantum-classical-hamiltonian-gradients">
<h3>Quantum-classical Hamiltonian gradients<a class="headerlink" href="#quantum-classical-hamiltonian-gradients" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="id0">
<span class="sig-prename descclassname"><span class="pre">sim.model.</span></span><span class="sig-name descname"><span class="pre">dh_c_dzc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constants</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">z</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#id0" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>z</strong> (<em>np.ndarray</em><em>(</em><em>(</em><em>batch_size</em><em>, </em><em>sim.model.constants.num_classical_coordinates</em><em>)</em><em>, </em><em>dtype=complex</em><em>)</em>) – complex-valued classical coordinate.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Indices of nonzero values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray((# of nonzero values, 4), dtype=int)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Values</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray((# of nonzero values), dtype=complex)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Shape of dense gradient: (batch_size, sim.model.constants.num_classical_coordinates, sim.model.constants.num_quantum_states, sim.model.constants.num_quantum_states)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple</p>
</dd>
</dl>
</dd></dl>

<p>QC Lab utilizes a finite difference method to calculate the gradient of the quantum-classical Hamiltonian. Unlike that of the
classical Hamiltonian, however, the output is in a sparse format.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>dh_qc_dzc_finite_differences_delta</cite></p></td>
<td><p>finite difference that each coordinate is varied by.</p></td>
<td><p>1e-6</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="surface-hopping-switching-algorithm">
<h3>Surface Hopping Switching Algorithm<a class="headerlink" href="#surface-hopping-switching-algorithm" title="Link to this heading">#</a></h3>
<dl class="py function">
<dt class="sig sig-object py" id="sim.model.hop_function">
<span class="sig-prename descclassname"><span class="pre">sim.model.</span></span><span class="sig-name descname"><span class="pre">hop_function</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">constants</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">parameters</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">delta_z</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">delta_z</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ev_diff</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">ev_diff</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#sim.model.hop_function" title="Link to this definition">#</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>z</strong> (<em>np.ndarray</em><em>(</em><em>sim.model.constants.num_classical_coordinates</em><em>, </em><em>dtype=complex</em><em>)</em>) – Complex-valued classical coordinate (in a single trajectory).</p></li>
<li><p><strong>delta_z</strong> (<em>np.ndarray</em><em>(</em><em>sim.model.constants.num_classical_coordinates</em><em>, </em><em>dtype=complex</em><em>)</em>) – Rescaling direction.</p></li>
<li><p><strong>ev_diff</strong> (<em>float</em>) – Energy difference between final and initial surface (final - initial).</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Rescaled coordinate.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>np.ndarray(sim.model.constants.num_classical_coordinates, dtype=complex)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>True or False depending on if a hop happened.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Bool.</p>
</dd>
</dl>
</dd></dl>

<p>QC Lab implements a numerical method to find the scalar factor (gamma) required to rescale classical coordinates in the surface hopping algorithm. It works by constructing a uniform grid with
<cite>numerical_fssh_hop_num_points</cite> points
from negative to positive and determines the point at which energy is conserved the closest. It then recenters the
grid at that point and reduces the range by 0.5 and once again searches for the point at which energy is conserved the closest. It repeats that step for <cite>numerical_fssh_hop_max_iter</cite>
iterations or until the energy difference is less than <cite>numerical_fssh_hop_threshold</cite>. If the energy it reaches is less than the threshold then the hop is
accepted, if it is greater then the hop is rejected.</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable name</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>Default value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><cite>numerical_fssh_hop_gamma_range</cite></p></td>
<td><p>Interval from minus to positive over which gamma is initially sampled.</p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p><cite>numerical_fssh_hop_num_points</cite></p></td>
<td><p>The number of points on the grid used to sample gamma.</p></td>
<td><p>10</p></td>
</tr>
<tr class="row-even"><td><p><cite>numerical_fssh_hop_threshold</cite></p></td>
<td><p>The threshold used to determine if a hop is conserving energy at a given gamma.</p></td>
<td><p>1e-6</p></td>
</tr>
<tr class="row-odd"><td><p><cite>numerical_fssh_hop_max_iter</cite></p></td>
<td><p>The maximum number of iterations before a search for gamma is halted.</p></td>
<td><p>20</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="model_dev.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model Development</p>
      </div>
    </a>
    <a class="right-next"
       href="algorithm_dev.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Algorithm Development</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-simulation-settings">Default Simulation Settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#default-model-attributes">Default Model Attributes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initialization-of-classical-coordinates">Initialization of classical coordinates</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sim.model.init_classical"><code class="docutils literal notranslate"><span class="pre">sim.model.init_classical()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classical-hamiltonian-gradients">Classical Hamiltonian gradients</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sim.model.dh_c_dzc"><code class="docutils literal notranslate"><span class="pre">sim.model.dh_c_dzc()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#quantum-classical-hamiltonian-gradients">Quantum-classical Hamiltonian gradients</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id0"><code class="docutils literal notranslate"><span class="pre">sim.model.dh_c_dzc()</span></code></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#surface-hopping-switching-algorithm">Surface Hopping Switching Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sim.model.hop_function"><code class="docutils literal notranslate"><span class="pre">sim.model.hop_function()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/defaults.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025-2025, Tempelaar Team.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>